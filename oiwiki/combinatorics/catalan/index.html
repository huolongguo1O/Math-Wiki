
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Catalan - Math-wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Math-wiki" class="md-header__button md-logo" aria-label="Math-wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Math-wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Catalan
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  简介

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ineq/" class="md-tabs__link">
          
  
  
  不等式

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../number-theory/basic/" class="md-tabs__link">
          
  
  
  数论

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../complex/" class="md-tabs__link">
          
  
  
  杂项

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Math-wiki" class="md-nav__button md-logo" aria-label="Math-wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Math-wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    不等式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    不等式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ineq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最最最基本的不等关系
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ineq/am-gm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    均值不等式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ineq/cauchy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    柯西不等式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    数论
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    数论
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础知识
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/mod-arithmetic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    模运算
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/prime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    质数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/gcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最大公约数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/bezouts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bezout定理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/inverse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    逆元
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/crt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中国剩余定理（CRT）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/euler-function.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    欧拉函数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/fermat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    费马小定理与欧拉定理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/primitive-root/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    阶与原根
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/congruence-equation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    同余方程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/linear-congruence-equation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    线性同余方程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/quadratic-residue.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    二次剩余
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/pell-equation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pell方程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/mobius/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    莫比乌斯反演
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/lifting-the-exponent.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LTE引理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/quadratic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    二次域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    杂项
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    杂项
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../complex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    复数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        引入
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      
        应用
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      
        常见形式
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="常见形式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      
        代数推演
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      
        组合意义
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      
        例题
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      
        习题
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      
        参考资料与注释
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Catalan</h1>

<h2 id="_1">引入</h2>
<p>Catalan 数经常出现在各类计数问题中。比利时数学家 Eugène Charles Catalan 在 1958 年研究括号序列计数问题时发现了这一数列，它也因此得名。清朝数学家明安图早在 18 世纪 30 年代就已经发现这一数列。</p>
<p>Catalan 数满足如下递推关系：</p>
<div class="arithmatex">\[
C_n = \begin{cases}
1, &amp; n = 0, \\
\sum_{i=0}^{n-1} C_{i}C_{n-1-i}, &amp; n &gt; 0.
\end{cases}\tag{1}
\]</div>
<p>数列的前几项为：（<a href="https://oeis.org/A000108">OEIS: A000108</a>，下标从 <span class="arithmatex">\(0\)</span> 开始）</p>
<div class="arithmatex">\[
1,1,2,5,14,42,132,429,1430,\ldots
\]</div>
<h2 id="_2">应用</h2>
<p>Catalan 数 <span class="arithmatex">\(C_n\)</span> 的递推关系有着天然的递归结构：规模为 <span class="arithmatex">\(n\)</span> 的计数问题 <span class="arithmatex">\(C_n\)</span>，可以通过枚举分界点，分拆为两个规模分别为 <span class="arithmatex">\(i\)</span> 和 <span class="arithmatex">\((n-1-i)\)</span> 的子问题。这一递推关系使得 Catalan 数广泛出现于各类具有类似递归结构的问题中。</p>
<ul>
<li>
<p><a id="path-counting"></a><strong>路径计数问题</strong>：有一个大小为 <span class="arithmatex">\(n\times n\)</span> 的方格图，左下角为 <span class="arithmatex">\((0, 0)\)</span>，右上角为 <span class="arithmatex">\((n, n)\)</span>。从左下角开始，每次都只能向右或者向上走一单位，不走到对角线 <span class="arithmatex">\(y=x\)</span> 上方（但可以触碰）的情况下，到达右上角的路径总数为 <span class="arithmatex">\(C_n\)</span>。</p>
<p>??? note "证明"
    设方案数为 <span class="arithmatex">\(T_n\)</span>。考虑 <span class="arithmatex">\(n \ge 2\)</span> 的情况。设路径 <strong>第一次</strong> 走到对角线 <span class="arithmatex">\(y=x\)</span> 的点是 <span class="arithmatex">\((k,k)~(k \in [1,n])\)</span>。考察从 <span class="arithmatex">\((0,0)\)</span> 到 <span class="arithmatex">\((k,k)\)</span> 的除起点和终点外，中间的点 <strong>不经过对角线（不能碰到）</strong> 的路径。</p>
<pre><code>![catalan2](./images/catalan-2.svg)

如图所示，这些路径的第一步一定向右，从 $(0,0)$ 到 $(1,0)$；最后一步一定向上，从 $(k,k-1)$ 到 $(k,k)$。因此，这些路径就是从 $(1,0)$ 到 $(k,k-1)$ 的不越过直线 $y=x-1$ 的路径，这样路径的数目就是 $T_{k-1}$。同时，从 $(k,k)$ 到 $(n,n)$ 的合法路径数就是 $T_{n-k}$。根据乘法原理，第一次在 $(k,k)$ 处触碰对角线的路径数目为 $T_{k-1} T_{n-k}$。枚举 $k$ 的所有可能性，所有合法路径的数目为

$$
T_n = \sum_{k=1}^n T_{k-1}T_{n-k}.
$$

做代换 $k=i+1$ 就可以发现，这就是 Catalan 数的递推关系。由 $T_0=1$ 可知 $T_n = C_n$。
</code></pre>
<!-- To make bot happy. Do NOT delete this line. -->
</li>
<li>
<p><strong>圆内不相交弦计数问题</strong>：圆上有 <span class="arithmatex">\(2n\)</span> 个点，将这些点成对连接起来且使得所得到的 <span class="arithmatex">\(n\)</span> 条线段两两不交的方案数是 <span class="arithmatex">\(C_n\)</span>。</p>
<p>??? note "证明"
    记 <span class="arithmatex">\(2n\)</span> 个点的方案数为 <span class="arithmatex">\(T_n\)</span>。将 <span class="arithmatex">\(2n\)</span> 个点按顺时针标号，分别为 <span class="arithmatex">\(1,2,\ldots,2n\)</span>。由于弦两两不交，<span class="arithmatex">\(1\)</span> 号点只能连接偶数号点；否则，两点之间的奇数个点无法在不穿过两点连线的情况下两两配对。如果连接了 <span class="arithmatex">\(1\)</span> 和 <span class="arithmatex">\(2k~(k\in[1,n])\)</span>，那么左边有 <span class="arithmatex">\(2k-2\)</span> 个点，右边有 <span class="arithmatex">\(2n-2k\)</span> 个点，由乘法原理，这样的方案数为 <span class="arithmatex">\(T_{k-1}T_{n-k}\)</span>。因此，枚举 <span class="arithmatex">\(k\)</span>，有 <span class="arithmatex">\(T_n = \sum_{k=1}^n T_{k-1} T_{n-k}\)</span>。令 <span class="arithmatex">\(k=i+1\)</span>，就得到 Catalan 数的递推关系。由 <span class="arithmatex">\(T_0=1\)</span> 可知 <span class="arithmatex">\(T_n=C_n\)</span>。</p>
<!-- To make bot happy. Do NOT delete this line. -->
</li>
<li>
<p><a id="triangulation-counting"></a><strong>三角剖分计数问题</strong>：对角线不相交的情况下，将一个凸 <span class="arithmatex">\((n+2)\)</span> 边形区域分成三角形区域的方法数为 <span class="arithmatex">\(C_n\)</span>。</p>
<p>??? note "证明"
    设 <span class="arithmatex">\((n+2)\)</span> 边形三角剖分的方案数为 <span class="arithmatex">\(T_n\)</span>。先选定一条边 <span class="arithmatex">\((1,n+2)\)</span> 作为基边，它一定属于一个三角形，记该三角形的第三个点为 <span class="arithmatex">\(k~(k\in[2,n+1])\)</span>。这样，原凸多边形变成了三个部分：</p>
<pre><code>-   三角形 $(1,k,n+2)$。
-   $k$ 边形，顶点 $1\sim k$。
-   $(n+3-k)$ 边形，顶点 $k\sim (n+2)$。

后面两个部分都是子问题，所以，有递推关系

$$
T_n = \sum_{k=2}^{n+1} T_{k-2}T_{n+1-k}.
$$

令 $k=i+2$，就得到 Catalan 数递归关系。由 $T_0=T_1=1$ 可知 $T_n=C_n$。
</code></pre>
<!-- To make bot happy. Do NOT delete this line. -->
</li>
<li>
<p><strong>二叉树计数问题</strong>：含有 <span class="arithmatex">\(n\)</span> 个结点的形态不同的二叉树数目为 <span class="arithmatex">\(C_n\)</span>。等价地，含有 <span class="arithmatex">\(n\)</span> 个非叶结点的形态不同的满二叉树数目为 <span class="arithmatex">\(C_{n}\)</span>。</p>
<p>??? note "证明"
    记 <span class="arithmatex">\(n\)</span> 个结点的二叉树数目为 <span class="arithmatex">\(T_n\)</span>。任取一个根结点，枚举左右子树大小。设左子树大小为 <span class="arithmatex">\(i\in[0,n-1]\)</span>，则右子树大小为 <span class="arithmatex">\((n-1-i)\)</span>。左右子树均为子问题，所以，有递推关系</p>
<pre><code>$$
T_n = \sum_{i=0}^{n-1}T_iT_{n-1-i}.
$$

这就是 Catalan 数递推关系。由 $T_0=T_1=1$ 可知 $T_n=C_n$。
</code></pre>
<!-- To make bot happy. Do NOT delete this line. -->
</li>
<li>
<p><strong>括号序列计数问题</strong>：由 <span class="arithmatex">\(n\)</span> 对括号构成的合法括号序列数为 <span class="arithmatex">\(C_n\)</span>。</p>
<p>??? note "证明"
    联系路径计数问题。将左括号视为向上走，右括号视为向右走。合法括号序列即为，在任意位置，左括号的数量不少于右括号的数量。相当于路径计数问题中，在任意时刻，向上走的次数不少于向右走的次数。因此，合法括号序列与合法路径之间存在双射。合法括号序列的数目同样为 <span class="arithmatex">\(C_n\)</span>。</p>
<!-- To make bot happy. Do NOT delete this line. -->
</li>
<li>
<p><strong>出栈序列计数问题</strong>：一个栈（无穷大）的进栈序列为 <span class="arithmatex">\(1,2,3, \ldots ,n\)</span>，合法出栈序列的数目为 <span class="arithmatex">\(C_n\)</span>。</p>
<p>??? note "证明"
    联系括号序列计数问题。将入栈视为左括号，出栈视为右括号。任意时刻，入栈的次数不少于出栈的次数。因此，合法出栈序列与合法括号序列之间存在双射。合法出栈序列的数目同样为 <span class="arithmatex">\(C_n\)</span>。</p>
<!-- To make bot happy. Do NOT delete this line. -->
</li>
<li>
<p><a id="seq-counting"></a><strong>数列计数问题</strong>：由 <span class="arithmatex">\(n\)</span> 个 <span class="arithmatex">\(+1\)</span> 和 <span class="arithmatex">\(n\)</span> 个 <span class="arithmatex">\(-1\)</span> 组成的数列 <span class="arithmatex">\(a_1,a_2, \ldots ,a_{2n}\)</span> 中，部分和满足 <span class="arithmatex">\(a_1+a_2+ \ldots +a_k \geq 0~(k=1,2,3, \ldots ,2n)\)</span> 的数列数目为 <span class="arithmatex">\(C_n\)</span>。</p>
<p>??? note "证明"
    联系括号序列计数问题。将 <span class="arithmatex">\(+1\)</span> 视为左括号，<span class="arithmatex">\(-1\)</span> 视为右括号。任意时刻，<span class="arithmatex">\(+1\)</span> 的数量不少于 <span class="arithmatex">\(-1\)</span> 的数量。因此，合法数列与合法括号序列之间存在双射。合法数列的数目同样为 <span class="arithmatex">\(C_n\)</span>。</p>
</li>
</ul>
<p>尽管这一递推关系应用广泛，但是直接计算复杂度较高，需要寻找更为简单的公式。</p>
<h2 id="_3">常见形式</h2>
<p>Catalan 数有如下常见的表达式：</p>
<div class="arithmatex">\[
C_n = \frac{1}{n+1}\binom{2n}{n} = \dfrac{(2n)!}{n!(n+1)!},~ n\ge 0. \tag{2}
\]</div>
<div class="arithmatex">\[
C_n = \binom{2n}{n} - \binom{2n}{n+1},~n \ge 0. \tag{3}
\]</div>
<div class="arithmatex">\[
C_n = \frac{(4n-2)}{n+1}C_{n-1},~ n &gt; 0,~ C_0 = 1. \tag{4}
\]</div>
<p>Catalan 数的这些形式都可以高效计算：前两个形式将它转换为阶乘和组合数的计算问题，第三个形式则提供了顺次计算的递推公式。</p>
<p>对于这三种常见形式，本文提供两种证明方式。</p>
<h3 id="_4">代数推演</h3>
<p>通过代数方法得出 Catalan 数的上述表达式共两步。首先，验证三个形式相互等价。</p>
<p>??? note "证明表达式 <span class="arithmatex">\((2)\sim(4)\)</span> 等价"
    只需要证明表达式 <span class="arithmatex">\((3)\)</span> 可以转化为表达式 <span class="arithmatex">\((2)\)</span> 中阶乘形式：</p>
<pre><code>$$
\begin{aligned}
C_n &amp;= \binom{2n}{n} - \binom{2n}{n+1} \\
&amp;= \frac{(2n)!}{n!n!} - \frac{(2n)!}{(n-1)!(n+1)!} \\
&amp;= \frac{(2n)!}{n!n!}\left(1 - \frac{n!}{(n-1)!(n+1)}\right) \\
&amp;= \frac{(2n)!}{n!n!}\left(1- \frac{n}{n+1}\right) \\
&amp;= \dfrac{(2n)!}{n!(n+1)!}.
\end{aligned}
$$

以及，表达式 $(4)$ 也可以转化为表达式 $(2)$ 中阶乘形式：

$$
C_n = \prod_{i=1}^n\frac{(4i-2)}{i+1} = \prod_{i=1}^n\frac{2i(2i-1)}{i(i+1)} = \dfrac{(2n)!}{n!(n+1)!}.
$$

因此，三个表达式互相等价。
</code></pre>
<p>紧接着，验证这些形式确实是 Catalan 数递推公式的解。为此，考虑使用生成函数方法直接求出递推公式 <span class="arithmatex">\((1)\)</span> 的解。</p>
<p>??? note "利用生成函数方法求解递推公式 <span class="arithmatex">\((1)\)</span>"
    考虑 Catalan 数的普通生成函数 <span class="arithmatex">\(C(x)=\sum_{n=0}^{\infty}C_nx^n\)</span>。由于 Catalan 数的递推关系和卷积形式很相似，所以考虑用卷积构造 <span class="arithmatex">\(C(x)\)</span> 的方程：</p>
<pre><code>$$
\begin{aligned}
C(x)&amp;=\sum_{n=0}^{\infty}C_nx^n\\
&amp;=1+\sum_{n=1}^{\infty}\left(\sum_{i=0}^{n-1}C_iC_{n-i-1}\right)x^{n}\\
&amp;=1+x\sum_{n=1}^{\infty}\sum_{i=0}^{n-1}C_ix^iC_{n-i-1}x^{n-i-1}\\
&amp;=1+x\sum_{i=0}^{\infty}C_ix^i\sum_{j=0}^{\infty}C_jx^j\\
&amp;=1+xC^2(x).
\end{aligned}
$$

其中，倒数第二个等号交换了求和次序，并令 $j=n-1-i$。由此，解得：

$$
C(x)=\dfrac{1\pm \sqrt{1-4x}}{2x} = \frac{2}{1\mp \sqrt{1-4x}}.
$$

由初值条件 $C_0=1$ 可知，$C(0)=1$。代入检验可以发现唯一可行的解就是

$$
C(x) = \dfrac{1- \sqrt{1-4x}}{2x}.
$$

接下来，需要将它展开为幂级数的形式。利用 $(1+x)^a$ 的 [幂级数展开式](../poly/intro.md#常见的幂级数展开式) 可知：

$$
\sqrt{1-4x} = \sum_{n=0}^{\infty} \dfrac{\left(\frac{1}{2}\right)_{-n}}{n!}(-4x)^n,
$$

其中，$\left(\dfrac{1}{2}\right)_{-n}$ 是下降阶乘幂：

$$
\begin{aligned}
\left(\frac{1}{2}\right)_{-n} &amp;= \prod_{k=0}^{n-1}\left(\dfrac{1}{2}-k\right) = \dfrac{1}{2^n}\prod_{k=1}^{n-1}(1-2k) = \dfrac{(-1)^{n-1}}{2^n}\prod_{k=1}^{n-1}(2k-1)\\
&amp;= \dfrac{(-1)^{n-1}}{2^{2n-1}}\prod_{k=1}^{n-1}\dfrac{(2k-1)2k}{k} = \dfrac{(-1)^{n-1}}{2^{2n-1}}\dfrac{(2n-2)!}{(n-1)!}.
\end{aligned}
$$

代入 $C(x)$ 的表达式，就有

$$
\begin{aligned}
C(x) &amp;= \dfrac{1}{2x}\left(1-\sum_{n=0}^{\infty} \dfrac{\left(\frac{1}{2}\right)_{-n}}{n!}(-4x)^n\right)\\
&amp;= -\dfrac{1}{2x}\sum_{n=1}^\infty \dfrac{(-4x)^n}{n!}\left(\frac{1}{2}\right)_{-n} \\
&amp;= -\dfrac{1}{2x}\sum_{n=1}^\infty \dfrac{(-4x)^n}{n!}\dfrac{(-1)^{n-1}}{2^{2n-1}}\dfrac{(2n-2)!}{(n-1)!} \\
&amp;= \sum_{n=1}^{\infty}\dfrac{(2n-2)!}{(n-1)!n!}x^{n-1}\\
&amp;= \sum_{n=0}^{\infty}\dfrac{(2n)!}{n!(n+1)!}x^n.
\end{aligned}
$$

由此，就得到 $C_n$ 的表达式 $(2)$。
</code></pre>
<h3 id="_5">组合意义</h3>
<p>由于 Catalan 数具有明显的组合意义，所以只使用组合计数方法同样可以证明这些形式。本节为三个表达式分别提供一个组合意义的证明。</p>
<p>??? note "表达式 <span class="arithmatex">\((2)\)</span> 的证明"
    考虑 <a href="#seq-counting">数列计数问题</a>。对于任意由 <span class="arithmatex">\(\pm 1\)</span> 组成的序列 <span class="arithmatex">\(\{a_i\}_{i=1}^{2n}\)</span>，定义它的部分和为 <span class="arithmatex">\(S_i = \sum_{j=1}^{i}a_i\)</span>，并定义它的 <strong>超额量</strong>（exceedance）为 <span class="arithmatex">\(S_i &lt; 0\)</span> 且 <span class="arithmatex">\(a_i = -1\)</span> 的下标数量。超额量为 <span class="arithmatex">\(0\)</span>，就等价于数列合法；超额量的取值范围是 <span class="arithmatex">\([0,n]\)</span>，共 <span class="arithmatex">\((n+1)\)</span> 种可能的取值。需要证明的是，不同超额量的数列数量其实是一样的。</p>
<pre><code>为此，可以构造一个从超额量为 $e &gt; 0$ 的数列到超额量为 $(e-1)$ 的数列的映射 $f$。对于超额量为 $e &gt; 0$ 的序列 $\{a_i\}$，取下标 $k$ 为使得 $S_i = 0$ 且 $a_i = +1$ 成立的下标最小值。将 $a_k$ 左右两侧的序列交换，就得到如下序列 $\{a'_i\}$：

$$
a_{k+1},a_{k+2},\cdots,a_{2n},a_k,a_{1},a_{2},\cdots,a_{k-1}.
$$

由于原序列中 $a_k$ 右侧部分在交换前后对应的部分和序列不变，所以它们贡献的超额量也不变。对于原序列中 $a_k$ 左侧部分，它们对应的部分和在交换后全部增加 $1$，因此，它们贡献的超额量会减少，而且减少的数量恰好等于原序列 $a_k$ 左侧部分中满足 $S_i=-1$ 且 $a_i=-1$ 的下标数量。因为 $a_k$ 的选取保证了这样的下标有且仅有一个，所以，序列 $\{a'_i\}$ 的超额量就等于 $(e-1)$。也就是说，映射 $f$ 可以将序列的超额量恰好减少 $1$。

映射 $f$ 是可逆的。注意到序列 $\{a'_i\}$ 中，$a_k$ 对应的位置恰好为满足 $S'_k=+1$ 且 $a'_i = +1$ 的下标最大值。这是因为交换后，这些部分和都比交换前对应的部分和恰好大 $1$，因此，现在的部分和为 $+1$ 对应交换前部分和等于 $0$。但是，根据 $k$ 的选取，交换前这一部分（即原序列 $a_k$ 左侧部分）是没有满足 $S_i = 0$ 且 $a_i = +1$ 成立的下标的。

由此，映射 $f$ 构成了超额量为 $e&gt;0$ 的序列和超额量为 $(e-1)$ 的序列之间的双射。这就说明，不同超额量的数列数量其实是一样的。由于数列总数是 $\dbinom{2n}{n}$，合法数列（即超额量为 $0$ 的数列）数量就等于

$$
C_n = \dfrac{1}{n+1}\dbinom{2n}{n}.
$$

这就证明了 Catalan 数的表达式 $(2)$。
</code></pre>
<p>??? note "表达式 <span class="arithmatex">\((3)\)</span> 的证明"
    考虑 <a href="#path-counting">路径计数问题</a>。这是典型的格路计数问题，可以通过反射原理求解。具体到本问题，考虑用总路径数目减去不合法的路径数目。总路径数一共要走 <span class="arithmatex">\(2n\)</span> 步，其中 <span class="arithmatex">\(n\)</span> 步向右，所以方案数为 <span class="arithmatex">\(\dbinom{2n}{n}\)</span>。一条路径不合法，当且仅当它碰到了直线 <span class="arithmatex">\(y = x+1\)</span>。对于任意一条非法路径，可以找到第一次碰到直线 <span class="arithmatex">\(y = x+1\)</span> 的位置，并将该位置之后的路径关于直线 <span class="arithmatex">\(y=x+1\)</span> 做对称。此时，可以发现，一条从 <span class="arithmatex">\((0,0)\)</span> 到 <span class="arithmatex">\((n,n)\)</span> 的非法路径，变成了一条从 <span class="arithmatex">\((0,0)\)</span> 到 <span class="arithmatex">\((n-1,n+1)\)</span> 的路径。</p>
<pre><code>![catalan1](./images/catalan-1.svg)

由于从 $(0,0)$ 到 $(n-1,n+1)$ 的路径必定要穿过直线 $y = x+1$，所以每条这样的路径都对应一条从 $(0,0)$ 到 $(n,n)$ 的非法路径。类似总路径数的计算，非法路径数目的总数就是 $\dbinom{2n}{n+1}$。因此，合法路径的总数为

$$
C_n = \binom{2n}{n} - \binom{2n}{n+1}.
$$

这就是 Catalan 数的表达式 $(3)$。
</code></pre>
<p>??? note "表达式 <span class="arithmatex">\((4)\)</span> 的证明"
    考虑 <a href="#triangulation-counting">三角剖分计数问题</a>。设 <span class="arithmatex">\(P\)</span> 是凸 <span class="arithmatex">\((n+2)\)</span> 边形，固定它的一个边为基边。对于多边形 <span class="arithmatex">\(P\)</span> 的每一个三角剖分，都可以选择它的一个非基边（包括三角剖分时新加的边）标记，并定向。这共有 <span class="arithmatex">\((4n+2)C_n\)</span> 种剖分加标记的方案。又设 <span class="arithmatex">\(Q\)</span> 是凸 <span class="arithmatex">\((n+3)\)</span> 边形，仍固定它的一个边为基边。对于多边形 <span class="arithmatex">\(Q\)</span>，可以选择它的一条非基边标记，然后再做三角剖分。这共有 <span class="arithmatex">\((n+2)C_{n+1}\)</span> 种标记加剖分的方案。</p>
<pre><code>![](./images/catalan-triangulation.svg)

如图所示，这两组操作得到的结果之间存在明显的双射。对于 $P$ 剖分并标记的一个结果，可以将它的标记边扩展为三角形，定向所指向的终点扩展为一条新边，并将这条新边打上标记，这就得到对 $Q$ 标记并剖分的一个结果；对于 $Q$ 标记并剖分的一个结果，可以将它的标记边压缩为一个点，并将压缩得到的对角线打上标记，且指向压缩得到的顶点，这就得到对 $P$ 剖分并标记的一个结果。因此，

$$
(4n+2)C_n = (n+2)C_{n+1}.
$$

稍作整理，并结合 $C_0=1$，就得到 Catalan 数的表达式 $(4)$。
</code></pre>
<h2 id="_6">例题</h2>
<p>???+ example "<a href="https://www.luogu.com.cn/problem/P1044">洛谷 P1044 栈</a>"
    入栈顺序为 <span class="arithmatex">\(1,2,\ldots ,n\)</span>，求所有可能的出栈顺序的总数。</p>
<p>??? note "参考代码"
    === "C++"
        <code>cpp
        --8&lt;-- "docs/math/code/combinatorics/catalan/catalan_1.cpp"</code></p>
<pre><code>=== "Python"
    ```python
    --8&lt;-- "docs/math/code/combinatorics/catalan/catalan_1.py"
    ```
</code></pre>
<h2 id="_7">习题</h2>
<ul>
<li><a href="https://www.luogu.com.cn/problem/P2532">Luogu P2532 [AHOI2012] 树屋阶梯</a></li>
<li><a href="https://www.luogu.com.cn/problem/P1641">Luogu P1641 [SCOI2010] 生成字符串</a></li>
<li><a href="https://www.luogu.com.cn/problem/P3200">Luogu P3200 [HNOI2009] 有趣的数列</a></li>
<li><a href="https://atcoder.jp/contests/abc205/tasks/abc205_e">AtCoder Beginner Contest 205 E - White and Black Balls</a></li>
<li><a href="https://www.luogu.com.cn/problem/AT_arc145_c">AtCoder Regular Contest 145 C - Split and Maximize</a></li>
<li><a href="https://www.luogu.com.cn/problem/P5014">Luogu P5014 水の三角（修改版）</a></li>
<li><a href="https://www.luogu.com.cn/problem/P3978">Luogu P3978 [TJOI2015] 概率论</a></li>
</ul>
<h2 id="_8">参考资料与注释</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Catalan_number">Catalan number - Wikipedia</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.expand", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>