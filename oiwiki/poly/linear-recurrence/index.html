
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Linear recurrence - Math-wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#简介" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Math-wiki" class="md-header__button md-logo" aria-label="Math-wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Math-wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Linear recurrence
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  简介

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../ineq/" class="md-tabs__link">
          
  
  
  不等式

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../number-theory/basic/" class="md-tabs__link">
          
  
  
  数论

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../complex/" class="md-tabs__link">
          
  
  
  杂项

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Math-wiki" class="md-nav__button md-logo" aria-label="Math-wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Math-wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    简介
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    不等式
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    不等式
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ineq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最最最基本的不等关系
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ineq/am-gm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    均值不等式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../ineq/cauchy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    柯西不等式
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    数论
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    数论
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    基础知识
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/mod-arithmetic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    模运算
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/prime/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    质数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/gcd/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    最大公约数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/bezouts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bezout定理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/inverse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    逆元
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/crt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    中国剩余定理（CRT）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/euler-function.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    欧拉函数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/fermat/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    费马小定理与欧拉定理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/primitive-root/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    阶与原根
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/congruence-equation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    同余方程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/linear-congruence-equation.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    线性同余方程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/quadratic-residue.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    二次剩余
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/pell-equation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pell方程
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/mobius/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    莫比乌斯反演
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/lifting-the-exponent.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    LTE引理
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../number-theory/quadratic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    二次域
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    杂项
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    杂项
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../complex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    复数
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#简介" class="md-nav__link">
    <span class="md-ellipsis">
      
        简介
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="简介">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fiduccia-算法" class="md-nav__link">
    <span class="md-ellipsis">
      
        Fiduccia 算法
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#表示为有理函数" class="md-nav__link">
    <span class="md-ellipsis">
      
        表示为有理函数
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bostanmori-算法" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bostan–Mori 算法
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bostan–Mori 算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#计算单项" class="md-nav__link">
    <span class="md-ellipsis">
      
        计算单项
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#计算连续若干项" class="md-nav__link">
    <span class="md-ellipsis">
      
        计算连续若干项
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#找到新的有理函数表示" class="md-nav__link">
    <span class="md-ellipsis">
      
        找到新的有理函数表示
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#参考文献" class="md-nav__link">
    <span class="md-ellipsis">
      
        参考文献
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Linear recurrence</h1>

<h2 id="简介">简介<a class="headerlink" href="#简介" title="Permanent link"></a></h2>
<p>常系数齐次线性递推数列（又称为 C-finite 或 C-recursive 数列）是常见的一类基础的递推数列。</p>
<p>对于数列 <span class="arithmatex">\(\left(a_j\right)_{j\geq 0}\)</span> 和其递推式</p>
<div class="arithmatex">\[
a_n=\sum_{j=1}^{d}c_ja_{n-j},\qquad (n\geq d)
\]</div>
<p>其中 <span class="arithmatex">\(c_j\)</span> 不全为零，我们的目标是在给出初值 <span class="arithmatex">\(a_0,\dots ,a_{d-1}\)</span> 和递推式中的 <span class="arithmatex">\(c_1,\dots ,c_d\)</span> 后求出 <span class="arithmatex">\(a_k\)</span>。如果 <span class="arithmatex">\(k\gg d\)</span>，我们想要更快速的算法。</p>
<p>这里 <span class="arithmatex">\(\left(a_j\right)_{j\geq 0}\)</span> 被称为 <span class="arithmatex">\(d\)</span> 阶的常系数齐次线性递推数列。</p>
<h3 id="fiduccia-算法">Fiduccia 算法<a class="headerlink" href="#fiduccia-算法" title="Permanent link"></a></h3>
<p>Fiduccia 算法使用多项式取模和快速幂来计算 <span class="arithmatex">\(a_k\)</span>，时间为 <span class="arithmatex">\(O(\mathsf{M}(d)\log k)\)</span>，其中 <span class="arithmatex">\(O(\mathsf{M}(d))\)</span> 表示两个次数为 <span class="arithmatex">\(O(d)\)</span> 的多项式相乘的时间。</p>
<p><strong>算法</strong>：构造多项式 <span class="arithmatex">\(\Gamma(x):=x^d-\sum_{j=0}^{d-1}c_{d-j}x^j\)</span> 和 <span class="arithmatex">\(A(x):=\sum_{j=0}^{d-1}a_jx^j\)</span>，那么</p>
<div class="arithmatex">\[
a_k=\left\langle x^k\bmod{\Gamma(x)},A(x)\right\rangle
\]</div>
<p>其中定义 <span class="arithmatex">\(\left\langle \left(\sum_{j=0}^{n-1}f_jx^j\right),\left(\sum_{j=0}^{n-1}g_jx^j\right) \right\rangle :=\sum_{j=0}^{n-1}f_jg_j\)</span> 为内积。</p>
<p><strong>证明</strong>：我们定义 <span class="arithmatex">\(\Gamma(x)\)</span> 的友矩阵为</p>
<div class="arithmatex">\[
C_\Gamma:=
\begin{bmatrix}
&amp;&amp;&amp;c_d \\
1&amp;&amp;&amp;c_{d-1} \\
&amp;\ddots &amp;&amp;\vdots \\
&amp;&amp;1&amp;c_1
\end{bmatrix}
\]</div>
<p>我们定义多项式 <span class="arithmatex">\(b(x):=\sum_{j=0}^{d-1}b_jx^j\)</span> 和</p>
<div class="arithmatex">\[
B_b:=\begin{bmatrix}b_0&amp;b_1&amp;\cdots &amp;b_{d-1}\end{bmatrix}^{\intercal}
\]</div>
<p>观察到</p>
<div class="arithmatex">\[
\underbrace{\begin{bmatrix}
&amp;&amp;&amp;c_d \\
1&amp;&amp;&amp;c_{d-1} \\
&amp;\ddots &amp;&amp;\vdots \\
&amp;&amp;1&amp;c_1
\end{bmatrix}}_{C_\Gamma}
\underbrace{\begin{bmatrix}
b_0 \\
b_1 \\
\vdots \\
b_{d-1}
\end{bmatrix}}_{B_b}=
\underbrace{\begin{bmatrix}
c_db_{d-1} \\
b_0+c_{d-1}b_{d-1} \\
\vdots \\
b_{d-2}+c_1b_{d-1}
\end{bmatrix}} _ {B_{xb\bmod{\Gamma}}}
\]</div>
<p>且</p>
<div class="arithmatex">\[
\begin{aligned}
C_\Gamma&amp;=\begin{bmatrix}B_{x\bmod{\Gamma}}&amp;B_{x^2\bmod{\Gamma}}&amp;\cdots &amp;B_{x^d\bmod{\Gamma}}\end{bmatrix}, \\
\left(C_\Gamma\right)^2&amp;=\begin{bmatrix}B_{x^2\bmod{\Gamma}}&amp;B_{x^3\bmod{\Gamma}}&amp;\cdots &amp;B_{x^{d+1}\bmod{\Gamma}}\end{bmatrix}, \\
\cdots \\
\left(C_\Gamma\right)^k&amp;=\begin{bmatrix}B_{x^k\bmod{\Gamma}}&amp;B_{x^{k+1}\bmod{\Gamma}}&amp;\cdots &amp;B_{x^{k+d}\bmod{\Gamma}}\end{bmatrix}
\end{aligned}
\]</div>
<p>我们将这个递推用矩阵表示有</p>
<div class="arithmatex">\[
\begin{bmatrix}
a_{k} \\
a_{k+1} \\
\vdots \\
a_{k+d-1}
\end{bmatrix}=\underbrace{\begin{bmatrix}
&amp;1&amp;&amp; \\
&amp;&amp;\ddots &amp; \\
&amp;&amp;&amp;1 \\
c_d&amp;c_{d-1}&amp;\cdots &amp;c_1
\end{bmatrix}^k} _ {\left(\left(C_\Gamma\right)^{\intercal}\right)^k=\left(\left(C_\Gamma\right)^{k}\right)^{\intercal}}
\begin{bmatrix}
a_0 \\
a_{1} \\
\vdots \\
a_{d-1}
\end{bmatrix}
\]</div>
<p>可知 <span class="arithmatex">\(\left(\left(C_\Gamma\right)^{k}\right)^{\intercal}\)</span> 的第一行为 <span class="arithmatex">\(B_{x^k\bmod{\Gamma}}\)</span>，根据矩阵乘法的定义得证。</p>
<h3 id="表示为有理函数">表示为有理函数<a class="headerlink" href="#表示为有理函数" title="Permanent link"></a></h3>
<p>对于上述数列 <span class="arithmatex">\(\left(a_j\right)_{j\geq 0}\)</span> 一定存在有理函数</p>
<div class="arithmatex">\[
\frac{P(x)}{Q(x)}=\sum_{j\geq 0}a_jx^j
\]</div>
<p>且 <span class="arithmatex">\(Q(x)=x^d\Gamma\left(x^{-1}\right)\)</span>，<span class="arithmatex">\(\deg{P}&lt;d\)</span>。我们称其为「<strong>有理函数</strong>」是因为 <span class="arithmatex">\(P(x),Q(x)\)</span> 是「<strong>多项式</strong>」。</p>
<p><strong>证明</strong>：对于 <span class="arithmatex">\(P(x)=\sum_{j=0}^{d-1}p_jx^j\)</span> 和 <span class="arithmatex">\(Q(x):=\sum_{j=0}^{d}q_jx^j\)</span> 考虑 <span class="arithmatex">\(\dfrac{P(x)}{Q(x)}=\sum_{j\geq 0}\tilde{q}_jx^j\)</span> 的系数定义，这几乎就是形式幂级数「<strong>除法</strong>」的定义，</p>
<div class="arithmatex">\[
\tilde{q}_N=
\begin{cases}
p_0q_0^{-1},&amp;\text{ if }N=0, \\
\left(p_N-\sum_{j=1}^{N}q_j\tilde{q}_{N-j}\right)\cdot q_0^{-1},&amp;\text{ else if }N&lt;d, \\
-q_0^{-1}\sum_{j=1}^{d}q_j\tilde{q}_{N-j},&amp;\text{ otherwise}.
\end{cases}
\]</div>
<p>我们只需要令</p>
<div class="arithmatex">\[
P(x)=\left(\left(\sum_{j\geq 0}a_jx^j\right)\cdot x^d\Gamma\left(x^{-1}\right)\right)\bmod{x^d}
\]</div>
<p>那么根据 <span class="arithmatex">\(\tilde{q}_N\)</span> 的定义，必然有 <span class="arithmatex">\(\dfrac{P(x)}{Q(x)}=\sum_{j\geq 0}a_jx^j\)</span>。</p>
<h3 id="bostanmori-算法">Bostan–Mori 算法<a class="headerlink" href="#bostanmori-算法" title="Permanent link"></a></h3>
<h4 id="计算单项">计算单项<a class="headerlink" href="#计算单项" title="Permanent link"></a></h4>
<p>我们的目标仍然是给出上述多项式 <span class="arithmatex">\(P(x),Q(x)\)</span>，求算 <span class="arithmatex">\(\left\lbrack x^k\right\rbrack\dfrac{P(x)}{Q(x)}\)</span>。</p>
<p>Bostan–Mori 算法基于 Graeffe 迭代，对于上述多项式 <span class="arithmatex">\(P(x),Q(x)\)</span> 有</p>
<div class="arithmatex">\[
\frac{P(x)}{Q(x)}=\frac{P(x)Q(-x)}{Q(x)Q(-x)}=\frac{U_0(x^2)+xU_1(x^2)}{V(x^2)}
\]</div>
<p>因为分母 <span class="arithmatex">\(V(x^2)\)</span> 是偶函数，所以子问题只需考虑其中的一侧</p>
<div class="arithmatex">\[
\left\lbrack x^k\right\rbrack\dfrac{P(x)}{Q(x)}=\left\lbrack x^{\left\lfloor k/2\right\rfloor}\right\rbrack \frac{U_{k\bmod{2}}(x)}{V(x)}
\]</div>
<p>我们付出两次多项式乘法的代价使得问题至少减少为原先的一半，而当 <span class="arithmatex">\(k=0\)</span> 时显然有 <span class="arithmatex">\(\left\lbrack x^0\right\rbrack \dfrac{P(x)}{Q(x)}=\dfrac{P(0)}{Q(0)}\)</span>，时间复杂度同上。</p>
<h4 id="计算连续若干项">计算连续若干项<a class="headerlink" href="#计算连续若干项" title="Permanent link"></a></h4>
<p>目标是给出上述多项式 <span class="arithmatex">\(P(x),Q(x)\)</span>，求算 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L,R\right)}\right\rbrack\dfrac{P(x)}{Q(x)}\)</span>。下面的计算中我们只需考虑对答案「<strong>有影响</strong>」的系数，这是 Bostan–Mori 算法的关键。</p>
<p>我们不妨假设 <span class="arithmatex">\(\deg{P}&lt;\deg{Q}\)</span>，否则我们也可以通过一次带余除法使问题回到这种情况。</p>
<p>我们先考虑更简单的问题：</p>
<div class="arithmatex">\[
\left\lbrack x^{\left\lbrack L,R\right)}\right\rbrack\frac{1}{Q(x)}=\left\lbrack x^{\left\lbrack L,R\right)}\right\rbrack\frac{1}{Q(x)Q(-x)}\cdot Q(-x)
\]</div>
<p>我们需要求出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L-\deg{Q},R\right)}\right\rbrack\dfrac{1}{Q(x)Q(-x)}\)</span> 然后作一次乘法并取出 <span class="arithmatex">\(x^L,\dots ,x^{R-1}\)</span> 的系数。令 <span class="arithmatex">\(V(x^2)=Q(x)Q(-x)\)</span> 那么我们只需求出</p>
<div class="arithmatex">\[
\left\lbrack x^{\left\lbrack \left\lceil\frac{L-\deg{Q}}{2}\right\rceil,\left\lceil\frac{R}{2}\right\rceil\right)}\right\rbrack\frac{1}{V(x)}
\]</div>
<p>就可以还原出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L-\deg{Q},R\right)}\right\rbrack\dfrac{1}{Q(x)Q(-x)}\)</span>。进而我们只需求出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L-\deg{P},R\right)}\right\rbrack\dfrac{1}{Q(x)}\)</span> 再和 <span class="arithmatex">\(P(x)\)</span> 作一次乘法即可求出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L,R\right)}\right\rbrack\dfrac{P(x)}{Q(x)}\)</span>。</p>
<p>上面的算法虽然已经可以工作，但是每一次的递归的时间复杂度与 <span class="arithmatex">\(R-L\)</span> 相关，我们希望能至少在递归求算时摆脱 <span class="arithmatex">\(R-L\)</span>，更具体的，我们先考虑求算 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L,L+\deg Q+1\right)}\right\rbrack \dfrac{1}{Q(x)}\)</span>，考虑</p>
<div class="arithmatex">\[
\left\lbrack x^{\left\lbrack L,L+\deg Q+1\right)}\right\rbrack \frac{1}{Q(x)}=\left\lbrack x^{\left\lbrack L,L+\deg Q+1\right)}\right\rbrack \dfrac{1}{Q(x)Q(-x)}\cdot Q(-x)
\]</div>
<p>我们需要求出</p>
<div class="arithmatex">\[
\left\lbrack x^{\left\lbrack L-\deg Q,L+\deg Q+1\right)}\right\rbrack \dfrac{1}{Q(x)Q(-x)}
\]</div>
<p>那么对于 <span class="arithmatex">\(V(x^2)=Q(x)Q(-x)\)</span> 而言，我们只需求出</p>
<div class="arithmatex">\[
\left\lbrack x^{\left\lbrack \lceil (L-\deg Q)/2 \rceil,\lceil (L+\deg Q+1)/2 \rceil\right)}\right\rbrack \frac{1}{V(x)}
\]</div>
<p>这是因为</p>
<div class="arithmatex">\[
\left\lbrack x^{k}\right\rbrack\dfrac{1}{Q(x)Q(-x)}=
\begin{cases}
\left\lbrack x^{k/2}\right\rbrack\dfrac{1}{V(x)},&amp;\text{if }k\equiv 0\pmod{2}, \\
0,&amp;\text{otherwise}.
\end{cases}
\]</div>
<p>我们知道 <span class="arithmatex">\(L+\deg Q\)</span> 和 <span class="arithmatex">\(L-\deg Q\)</span> 的奇偶性是一样的，所以</p>
<div class="arithmatex">\[
\left\lceil \frac{L+\deg Q+1}{2}\right\rceil -\left\lceil \frac{L-\deg Q}{2}\right\rceil =
\begin{cases}
\deg Q+1,&amp;\text{if }L+\deg Q\equiv 0\pmod{2}, \\
\deg Q,&amp;\text{otherwise}.
\end{cases}
\]</div>
<p>这样我们可以写出伪代码</p>
<div class="arithmatex">\[
\begin{array}{ll}
&amp;\textbf{Algorithm }\operatorname{Slice-Coefficients}(Q,L)\text{:} \\
&amp;\textbf{Input}\text{: }Q(x)\in\mathbb{C}\left\lbrack x\right\rbrack,L\in\mathbb{Z}\text{.} \\
&amp;\textbf{Output}\text{: }\left\lbrack x^{\left\lbrack L,L+\deg Q+1\right)}\right\rbrack Q(x)^{-1}\text{.} \\
1&amp;\textbf{if }L\leq 1\textbf{ then return }\left\lbrack x^{\left\lbrack L,L+\deg Q+1\right)}\right\rbrack Q(x)^{-1} \\
&amp;\text{Use other algorithm to compute }Q(x)^{-1} \\
2&amp;V(x^2)\gets Q(x)Q(-x) \\
3&amp;k\gets \left\lceil \frac{L-\deg Q}{2}\right\rceil \\
4&amp;(t_k,\dots ,t_{k+\deg Q})\gets \operatorname{Slice-Coefficients}\left(V,k\right) \\
5&amp;T(x)\gets x^{(L-\deg Q)\bmod{2}}\sum_{j=0}^{\deg Q}t_{j+k}x^{2j} \\
6&amp;\textbf{return }\left\lbrack x^{\left\lbrack \deg Q,2\deg Q+1\right)}\right\rbrack T(x)Q(-x)
\end{array}
\]</div>
<p>但是只有这个算法还不够，我们需要重新找到一个有理函数并求算更多系数。</p>
<h4 id="找到新的有理函数表示">找到新的有理函数表示<a class="headerlink" href="#找到新的有理函数表示" title="Permanent link"></a></h4>
<p>我们知道 <span class="arithmatex">\(Q(x)\)</span> 本身和 <span class="arithmatex">\(Q(x)^{-1}\)</span> 的一部分连续的系数比如 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L,L+\deg Q\right)}\right\rbrack Q(x)^{-1}\)</span> 和 <span class="arithmatex">\(L\geq 0\)</span>，我们希望求出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L+\deg Q,L+2\deg Q\right)}\right\rbrack Q(x)^{-1}\)</span>，这等价于我们要求某个 <span class="arithmatex">\(P(x)\)</span> 且 <span class="arithmatex">\(\deg P&lt; \deg Q\)</span> 使得 <span class="arithmatex">\(\dfrac{P(x)}{Q(x)}\)</span> 的前 <span class="arithmatex">\(\deg Q\)</span> 项与 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L,L+\deg Q\right)}\right\rbrack Q(x)^{-1}\)</span> 相同。简单来说：递推关系（有理函数的分母）是不变的，我们所做的只是更换初值（有理函数的分子）。</p>
<p>具体的，考虑</p>
<div class="arithmatex">\[
\frac{P(x)}{Q(x)}=\sum_{j\geq 0}a_jx^j
\]</div>
<p>我们现在希望将递推前进 <span class="arithmatex">\(n\)</span> 项，那么就是</p>
<div class="arithmatex">\[
\sum_{j\geq n}a_jx^{j-n}=\frac{P(x)}{Q(x)x^n}-\frac{Q(x)\sum_{j=0}^{n-1}a_jx^j}{Q(x)x^n}
\]</div>
<p>我们先用一次 <span class="arithmatex">\(\operatorname{Slice-Coefficients}(Q,L-\deg{P})\)</span> 计算出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L-\deg{P},L-\deg{P}+\deg{Q}+1\right)}\right\rbrack Q(x)^{-1}\)</span>，然后我们扩展合并出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack L-\deg{P},L+\deg{Q}\right)}\right\rbrack Q(x)^{-1}\)</span>，再重新计算一个分子使得</p>
<div class="arithmatex">\[
\frac{\widetilde{P}(x)}{Q(x)}=\sum_{j\geq 0}\left(\left\lbrack x^{L+j}\right\rbrack \frac{P(x)}{Q(x)}\right)x^j
\]</div>
<p>最后我们使用形式幂级数的除法计算出 <span class="arithmatex">\(\left\lbrack x^{\left\lbrack 0,R-L\right)}\right\rbrack\dfrac{\widetilde{P}(x)}{Q(x)}\)</span>，时间为 <span class="arithmatex">\(O(\mathsf{M}(d)\log L+\mathsf{M}(R-L))\)</span>。</p>
<h2 id="参考文献">参考文献<a class="headerlink" href="#参考文献" title="Permanent link"></a></h2>
<ol>
<li>Alin Bostan, Ryuhei Mori.<a href="https://arxiv.org/abs/2008.08822">A Simple and Fast Algorithm for Computing the <span class="arithmatex">\(N\)</span>-th Term of a Linearly Recurrent Sequence</a>.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.expand", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../../_static/js/math-csr.js?math-csr"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>